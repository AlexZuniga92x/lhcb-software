package LbScriptsPolicy
version v1r0

macro install_command 'python $(LbScriptsPolicy_root)/cmt/fragments/install.py -xCVS --log=./install.history '
macro uninstall_command 'python $(LbScriptsPolicy_root)/cmt/fragments/install.py -u --log=./install.history '

macro remove_command "$(cmt_uninstallarea_command)"

cmtpath_pattern \
   macro <project>_home "<path>" ; \
   set <project>_HOME "$(<project>_home)"

#--------------------------------------------
# Patterns for specifically declaring and installing python files in the
# current installation area
#--------------------------------------------

cmtpath_pattern \
   macro <project>_install_python "" \
         <project>_without_installarea "" \
         <project>_with_installarea&Unix "<path>/$(<project>_installarea_prefix)/python"\
         <project>_with_installarea&WIN32 "<path>\$(<project>_installarea_prefix)\python" ; \
    path_remove  PYTHONPATH ${<project>_install_python} ; \ 
    path_prepend PYTHONPATH ${<project>_install_python}

pattern install_python_modules \
    macro <package>_install_python "" \
         <project>_without_installarea&Unix "$(<package>_root)/python" \
         <project>_without_installarea&WIN32 "$(<package>_root)\python" ; \
    path_remove  PYTHONPATH ${<package>_install_python} ; \ 
    path_prepend PYTHONPATH ${<package>_install_python} ; \
    document install_python <package>_python ; \
    apply_pattern install_python_init ; \
    macro_append <package>_python_init_dependencies " <package>_python " ;
    
pattern install_custom_python_modules \
    macro <package>_install_python "" \
         <project>_without_installarea&Unix "$(<package>_root)/<source>" \
         <project>_without_installarea&WIN32 "$(<package>_root)\<source>" ; \
    path_remove  PYTHONPATH ${<package>_install_python} ; \ 
    path_prepend PYTHONPATH ${<package>_install_python} ; \
    document install_python <package>_<source>_<offset>_python source=<source> offset=<offset> ; \
    apply_pattern install_python_init ; \
    macro_append <package>_python_init_dependencies " <package>_<source>_<offset>_python " ;

make_fragment install_python -header=install_python_header


pattern install_python_init \
	document python_init <package>_python_init package=<package>

make_fragment python_init -header=python_init_header -dependencies

pattern python_alias \
    set_append PYTHONALIASDEF " <script>:$(<package>_root) " ; \
    alias <script> "python $(<project>_home)/InstallArea/scripts/<script>.py" ; \
    document python_alias <script>_python_alias script=<script> ; \
    macro_append <script>_python_alias_dependencies " install_scripts "

make_fragment python_alias -header=python_alias_header -dependencies

action ShowPythonAlias "echo $(PYTHONALIASDEF) | tr ' ' '\n' " \
            WIN32           "echo $(PYTHONALIASDEF)"




pattern source_shell_alias \
    set_append SOURCESHELLALIASLIST " $(<package>_cmtpath)/InstallArea/scripts/<script> " ; \
    set_append SOURCESHELLALIASDEF " <script>:$(<package>_root) "

cmtpath_pattern \
    setup_script $(LBSCRIPTSPOLICYROOT)/scripts/SourceShellAlias

action ShowSourceShellAlias "echo $(SOURCESHELLALIASDEF) | tr ' ' '\n' " \
            WIN32           "echo $(SOURCESHELLALIASDEF)"



pattern shell_alias \
    set_append SHELLALIASLIST " <script> " ; \
    set_append SHELLALIASDEF " <script>:$(<package>_root)" 
    

cmtpath_pattern \
    setup_script $(LBSCRIPTSPOLICYROOT)/scripts/ShellAlias 

action ShowShellAlias "echo $(SHELLALIASDEF) | tr ' ' '\n' " \
            WIN32     "echo $(SHELLALIASDEF)"

action ShowAlias "echo $(PYTHONALIASDEF) $(SHELLALIASDEF) $(SOURCESHELLALIASDEF) | tr ' ' '\n' " \
           WIN32 "echo $(PYTHONALIASDEF) $(SHELLALIASDEF) $(SOURCESHELLALIASDEF)"

apply_pattern source_shell_alias script=ShellAlias
apply_pattern source_shell_alias script=SourceShellAlias

#--------------------------------------------
# Patterns for specifically declaring and installing script files in the
# current installation area
#--------------------------------------------

cmtpath_pattern \
   macro <project>_install_scripts "" \
         <project>_without_installarea "" \
         <project>_with_installarea&Unix "<path>/$(<project>_installarea_prefix)/scripts"\
         <project>_with_installarea&WIN32 "<path>\$(<project>_installarea_prefix)\scripts" ; \
    path_remove  PATH ${<project>_install_scripts} ; \ 
    path_prepend PATH ${<project>_install_scripts}

pattern install_scripts \
    macro <package>_install_python "" \
         <project>_without_installarea&Unix "$(<package>_root)/scripts" \
         <project>_without_installarea&WIN32 "$(<package>_root)\scripts" ; \
    path_remove  PATH ${<package>_install_scripts} ; \ 
    path_prepend PATH ${<package>_install_scripts} ; \
    document install_scripts install_scripts 
    
    
make_fragment install_scripts -header=install_scripts_header


#---------------------------------------------------
# Automatic Installation
#---------------------------------------------------

cmtpath_pattern \
    apply_pattern install_scripts ; \
    apply_pattern install_python_modules ;

#---------------------------------------------------
# remove CMTPATH from the environment
#---------------------------------------------------

apply_pattern source_shell_alias script=NoCMTPATH

# remove CMTPATH from the environment
setup_script ../scripts/NoCMTPATH

