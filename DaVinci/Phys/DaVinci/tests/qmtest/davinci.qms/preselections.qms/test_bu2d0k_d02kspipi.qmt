<?xml version="1.0" ?>
<!DOCTYPE extension  PUBLIC '-//QM/2.3/Extension//EN'  'http://www.codesourcery.com/qm/dtds/2.3/-//qm/2.3/extension//en.dtd'>
<extension class="GaudiTest.GaudiExeTest" kind="test">
<argument name="program"><text>gaudirun.py</text></argument>
<argument name="args"><set>
  <text>../options/DVTestBu2D0K_D02KsPiPi.opts</text>
</set></argument>
<argument name="validator"><text>
reference = """
=====================================================================================
                       TestCorrelations.AlgorithmCorrelations
=====================================================================================
    Algorithm                 Eff.      1      2      3      4      5      6
-------------------------------------------------------------------------------------
  1 AllTrueNoPIDsDecay        3.0% |  ##### 100.0%  *****   5.9%   6.5%   1.9%
  2 AllTrueLooseDecay         3.0% | 100.0%  #####  *****   5.9%   6.5%   1.9%
  3 PreselBu2D0K_D02KsPiPi    0.0% |   0.0%   0.0%  #####   0.0%   0.0%   0.0%
  4 StdDC06LooseD02KsPiPi    17.0% |  33.3%  33.3%  *****  #####  23.9%  27.8%
  5 StdDC06LooseKsLL         46.0% | 100.0% 100.0%  *****  64.7%  #####  57.4%
  6 StdDC06LooseKsDD         54.0% |  33.3%  33.3%  *****  88.2%  67.4%  #####
=====================================================================================
"""

# split reference file, sanitize EOLs and remove empty lines
reflines = filter(None,map(lambda s: s.rstrip(), reference.splitlines()))
# the same on standard output
outlines = filter(None,map(lambda s: s.rstrip(), stdout.splitlines()))

# find the reference block in the output file
try:
    sign_pos = 1
    pos = outlines.index(reflines[1])
    outlines = outlines[pos-sign_pos:pos+len(reflines)-sign_pos]
    if reflines != outlines:
        causes.append("correlation table")
        result["CorrelationTest.expected"] = result.Quote("\n".join(reflines))
        result["CorrelationTest.observer"] = result.Quote("\n".join(outlines))
except ValueError:
    causes.append("missing correlation table")
</text></argument>
</extension>
