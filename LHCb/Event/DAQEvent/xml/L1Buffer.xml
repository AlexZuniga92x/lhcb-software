<!-- ****************************************************************
     * L1Buffer                                                    *
     ****************************************************************-->
     <class 
      author="Helder Lopes"
      desc="L1 buffer"
      name="L1Buffer"
      location="DAQ/L1Buffer"
      id="1003"
      serializers="FALSE"
     >
       <enum
        desc="Define the bank types for L1 trigger buffer"
        name="BankType"
        value="VeloR=0, VeloPhi, TT, LODU, L0Calo"
        access="PUBLIC"
       />
       <base name="DataObject"/>
       <import name="Event/DAQTypes" soft="FALSE"/>
       <import name="l1_int" ignore="TRUE"/>
       <attribute
        desc="Initial amount of memory allocated in words(16 bit)"
        name="initialSize"
        type="long"
        init="10000"
        getMeth="FALSE"
        setMeth="FALSE"
       />
       <attribute
        desc="Current amount of memory allocated in words(16 bit)"
        name="allocatedSize"
        type="long"
        setMeth="FALSE"
       />
       <attribute
        desc="Current amount of memory filled with data in words(16 bit)"
        name="currentSize"
        type="long"
        setMeth="FALSE"
       />
       <attribute
        desc="Pointer to beggining of L1 buffer"
        name="buffer"
        type="l1_int *"
        setMeth="FALSE"
        getMeth="FALSE"
       />
       <constructor
        desc="Constructor: Allocate inital amount of memory"
	initList="m_initialSize(100),m_currentSize(0)"
	>
         <code> m_buffer = new l1_int[m_initialSize];
	        m_allocatedSize = m_initialSize;
	 </code>
       </constructor>
       <destructor
        desc="destructor: Deallocate memory"
	>
         <code> delete [] m_buffer; </code>
       </destructor>  
       <method
        desc="accessor method to retrieve pointer to beginning of buffer"
        name="buffer"
        type="l1_int *"
       >
         <code> return m_buffer; </code>
       </method>
       <method
        desc="Add a new bank of data to the buffer"
        name="addBank"
        type="void"
       >
       <arg type="int" name="sourceID" />
       <arg type="int" name="bankType"  />
       <arg type="l1_int *" name="data"    />
       <arg type="long" name="dataSize"  />
         <code> 
  long bankSize = 1 + dataSize ;
  long evtSize=m_currentSize+bankSize;
  if(evtSize &gt; m_allocatedSize ) reallocate( evtSize );
  long size=m_currentSize;
// Assigning 7 bits to bankSize (bankSize&lt;128), 6 bits to sourceID (sourceID &lt; 64) and
// 3 bits to bankType (bankType &lt; 8 )
  m_buffer[size++]=l1_int(bankSize)+(l1_int(sourceID)&lt;&lt;7)+(l1_int(bankType)&lt;&lt;13);

  for( long i =0; i&lt;dataSize;++i) m_buffer[size++] = *(data++);
  m_currentSize+=bankSize;
 </code>
       </method>
       <method
        desc="Add a new bank of data to the buffer"
        name="addBank"
        type="void"
       >
       <arg type="int" name="sourceID" />
       <arg type="int" name="bankType"  />
       <arg type="std::vector &lt;l1_int&gt;" name="data"    />
         <code> 
  long bankSize = 1 + data.size() ;
  long evtSize=m_currentSize+bankSize;
  if(evtSize &gt; m_allocatedSize ) reallocate( evtSize );
  long size=m_currentSize;
  m_buffer[size++]=l1_int(bankSize)+(l1_int(sourceID)&lt;&lt;7)+(l1_int(bankType)&lt;&lt;13);
  for( std::vector&lt;l1_int&gt;::iterator i =data.begin(); i!=data.end();++i) m_buffer[size++] = *i;
  m_currentSize+=bankSize;
 </code>
       </method>
       <method
        desc="Reallocate buffer if more space is necessary"
        name="reallocate"
        type="void"
	access="PRIVATE"
       >
       <arg type="long" name="evtSize" />
         <code>
// To avoid many reallocations we are giving at least m_initialSize extra space
  long newSize = evtSize+m_initialSize;
  l1_int * newBuffer = new l1_int[newSize];
  for( long i =0; i&lt;m_currentSize;++i) newBuffer[i] = m_buffer[i];
  m_allocatedSize=newSize;
  delete [] m_buffer;
  m_buffer = newBuffer;
	  </code>
       </method>
     </class>
