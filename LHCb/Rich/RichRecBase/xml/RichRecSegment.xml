<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE gdd SYSTEM "gdd.dtd">
<gdd>
<package name="RichRecBase">

<!-- **************************************************************************
  * $Id: RichRecSegment.xml,v 1.4 2005-02-02 10:01:20 jonrob Exp $
  *****************************************************************************
  * XML-description of RichRecTrack class                                     *
  * author: Chris Jones   Christopher.Rob.Jones@cern.ch                       *
  * date:   2004-06-23                                                        *
  *****************************************************************************
  * $Log: not supported by cvs2svn $
  * Revision 1.3  2004/11/02 13:00:53  jonrob
  * Update the XML files for improved handling by cmt and make
  *
  * Revision 1.2  2004/07/29 09:03:12  jonesc
  * Add CVS Log history information to XML files
  *
  ************************************************************************* -->

 
<class 
        author           = "Chris Jones   (Christopher.Rob.Jones@cern.ch)" 
        desc             = "Rich reconstruction object describing a continuous track segment in a single radiator" 
        id               = "12423" 
        keyedContTypeDef = "TRUE" 
        location         = "Rec/Rich/RecoEvent/Segments" 
        name             = "RichRecSegment" 
        stdVectorTypeDef = "TRUE" >

        <base name="KeyedObject&lt;int&gt;"/>
        &KeyedObject;
            
        <import name="RichKernel/RichParticleIDType"/>
        <import name="RichEvent/RichTrackSegment"/>
        <import name="RichRecBase/RichPhotonSpectra"/>
        <import name="RichKernel/RichHypoData"/>
        <import name="Kernel/RichSmartID"/>
        <import name="Event/RichRecRing"/>

	<typedef 
		desc   = "type for internal storage for floating point data" 
		access = "PUBLIC" 
		def    = "FloatType" 
		type   = "float"
	/>
            
        <typedef 
                access = "PUBLIC" 
                def    = "PDGeomEffs" 
                desc   = "Data containers for each hypothesis" 
                type   = "std::map&lt;RichSmartID::KeyType,RichRecSegment::FloatType&gt;"
        />
            
        <typedef 
                access = "PUBLIC" 
                def    = "PDGeomEffsVector" 
                desc   = "Data containers for each hypothesis" 
                type   = "std::vector&lt; PDGeomEffs &gt;"
        />
            
        <constructor 
                desc     = "Constructor from segment information" 
                initList = "m_nEmittedPhotons(0), m_nDetectablePhotons(0),m_nSignalPhotons(0), m_nScatteredPhotons(0), m_emittedPhotonSpectra(enBins,minEn,maxEn), m_detectablePhotonSpectra(enBins,minEn,maxEn), m_signalPhotonSpectra(enBins,minEn,maxEn), m_geomEfficiencyPerPD(Rich::NParticleTypes, PDGeomEffs() ), m_geomEfficiency(0), m_geomEfficiencyScat(0), m_averageCKTheta(0), m_averageCKRadiusLocal(0), m_avSaturatedRadiusLocal(-999),m_trackSegment(segment), m_trackInfo(0), m_richRecTrack(pTrk), m_hypothesisRings(NULL)" >
                <arg const="TRUE"                  name="segment" type="RichTrackSegment"  />
                <arg const="FALSE" inout="BYVALUE" name="pTrk"    type="RichRecTrack*"     />
                <arg const="TRUE"  inout="BYVALUE" name="enBins"  type="unsigned int"      />
                <arg const="TRUE"  inout="BYVALUE" name="minEn"   type="RichRecSegment::FloatType"            />
                <arg const="TRUE"  inout="BYVALUE" name="maxEn"   type="RichRecSegment::FloatType"            />
                <code/>
        </constructor>
            
        <method 
                name  = "setGeomEfficiency"
                const = "FALSE" 
                desc  = "Set the geometrical efficiency for a given particle type" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"  />
                <arg const="TRUE" inout="BYVALUE" name="eff"  type="RichRecSegment::FloatType"                />
                <code>
                        m_geomEfficiency.setData(type,eff);
                </code>
        </method>
            
        <method 
                name  = "setGeomEfficiencyScat"
                const = "FALSE" 
                desc  = "Set the scattered geometrical efficiency for a given particle type" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"   />
                <arg const="TRUE" inout="BYVALUE" name="eff"  type="RichRecSegment::FloatType"                 />
                <code>
                        m_geomEfficiencyScat.setData(type,eff);
                </code>
        </method>
            
        <method 
                name  = "setNEmittedPhotons"
                const = "FALSE" 
                desc  = "Set the number of emitted photons for a given particle type" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <arg const="TRUE" inout="BYVALUE" name="photons" type="RichRecSegment::FloatType"/>
                <code>
                        m_nEmittedPhotons.setData(type,photons);
                </code>
        </method>
            
        <method 
                name  = "setNDetectablePhotons"
                const = "FALSE" 
                desc  = "Set the number of detectable photons for a given particle type">
                <arg const="TRUE" inout="BYVALUE" name="type"    type="Rich::ParticleIDType" />
                <arg const="TRUE" inout="BYVALUE" name="photons" type="RichRecSegment::FloatType"               />
                <code>
                        m_nDetectablePhotons.setData(type,photons);
                </code>
        </method>

        <method 
                name  = "setNSignalPhotons"
                const = "FALSE" 
                desc  = "Set the number of signal photons for a given particle type" >
                <arg const="TRUE" inout="BYVALUE" name="type"    type="Rich::ParticleIDType" />
                <arg const="TRUE" inout="BYVALUE" name="photons" type="RichRecSegment::FloatType"               />
                <code>
                        m_nSignalPhotons.setData(type,photons);
                </code>
        </method>
            
        <method 
                name  = "setNScatteredPhotons"
                const = "FALSE" 
                desc  = "Set the number of scattered photons for a given particle type" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <arg const="TRUE" inout="BYVALUE" name="photons" type="RichRecSegment::FloatType"/>
                <code>
                        m_nScatteredPhotons.setData(type,photons);
                </code>
        </method>
            
        <method 
                const = "FALSE" 
                desc  = "Set the average Cherenkov angle for a given particle type"
                name  = "setAverageCKTheta">
                <arg const="TRUE" inout="BYVALUE" name="type"  type="Rich::ParticleIDType"  />
                <arg const="TRUE" inout="BYVALUE" name="angle" type="RichRecSegment::FloatType"                />
                <code>
                        m_averageCKTheta.setData(type,angle);
                </code>
        </method>

        <method 
                const = "FALSE" 
                desc  = "Set the average radius of the Cherenkov Ring on the HPD detector plane, in local coordinates, for given particle ID type" 
                name  = "setAverageCKRadiusLocal">
                <arg const="TRUE" inout="BYVALUE" name="type"  type="Rich::ParticleIDType"  />
                <arg const="TRUE" inout="BYVALUE" name="radius" type="RichRecSegment::FloatType"                />
                <code>
                        m_averageCKRadiusLocal.setData(type,radius);
                </code>
        </method>
            
        <method 
                desc = "Method to create the geometrical efficiencies per PD" 
                name = "addToGeomEfficiencyPerPD">
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <arg const="TRUE" inout="BYVALUE" name="pd" type="RichSmartID::KeyType"/>
                <arg const="TRUE" inout="BYVALUE" name="signal" type="RichRecSegment::FloatType"/>
                <code>
                        (m_geomEfficiencyPerPD[type])[pd] += signal;
                </code>
        </method>
            
        <method 
                const = "TRUE" 
                desc  = "Returns the number of emitted photons for a given particle type" 
                name  = "nEmittedPhotons" 
                type  = "RichRecSegment::FloatType">
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return m_nEmittedPhotons[type];
                </code>
        </method>
            
        <method 
                const = "TRUE" 
                desc  = "Returns the number of detectable photons for a given particle type" 
                name  = "nDetectablePhotons" 
                type  = "RichRecSegment::FloatType" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return m_nDetectablePhotons[type];
                </code>
        </method>
            
        <method 
                const = "TRUE" 
                desc  = "Returns the number of signal photons for a given particle type" 
                name  = "nSignalPhotons" 
                type  = "RichRecSegment::FloatType">
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return m_nSignalPhotons[type];
                </code>
        </method>
            
        <method 
                const = "TRUE" 
                desc  = "Returns the number of scattered photons for a given particle type" 
                name  = "nScatteredPhotons" 
                type  = "RichRecSegment::FloatType" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>  
                        return m_nScatteredPhotons[type];
                </code>
        </method>
            
        <method 
                const = "TRUE" 
                desc  = "Returns the number of photons for a given particle type" 
                name  = "nTotalObservablePhotons" 
                type  = "RichRecSegment::FloatType" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return ( m_nSignalPhotons[type] + m_nScatteredPhotons[type] );
                </code>
        </method>
            
        <method 
                const = "TRUE" 
                desc  = "Get the geometrical efficiency for a given particle type" 
                name  = "geomEfficiency" 
                type  = "RichRecSegment::FloatType" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return m_geomEfficiency[type];
                </code>
        </method>
            
        <method 
                const = "TRUE" 
                desc  = "Get the scattered geometrical efficiency for a given particle type" 
                name  = "geomEfficiencyScat" 
                type  = "RichRecSegment::FloatType" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return m_geomEfficiencyScat[type];
                </code>
        </method>
            
        <method 
                const = "TRUE" 
                desc  = "Get the average Cherenkov angle for a given particle type" 
                name  = "averageCKTheta" 
                type  = "RichRecSegment::FloatType" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return m_averageCKTheta[type];
                </code>
        </method>

        <method 
                const = "TRUE" 
                desc  = "Get the average radius of the Cherenkov Ring on the HPD detector plane, in local coordinates, for given particle ID type" 
                name  = "averageCKRadiusLocal" 
                type  = "RichRecSegment::FloatType" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return m_averageCKRadiusLocal[type];
                </code>
        </method>
            
        <method 
                desc = "Returns the geometrical efficiency per PD for given hypothesis" 
                name = "geomEfficiencyPerPD" 
                type = "RichRecSegment::PDGeomEffs&amp;" >
                <arg const="TRUE" inout="BYVALUE" name="type" type="Rich::ParticleIDType"/>
                <code>
                        return m_geomEfficiencyPerPD[type];
                </code>
        </method>
            
        <method 
                desc = "Reset information to force recalculation" 
                name = "reset" 
                type = "void"
        />
            
        <attribute 
                array       = "FALSE" 
                compression = "TRUE" 
                desc        = "The number of emitted photons expected for each particle hypothesis" 
                name        = "nEmittedPhotons" 
                init        = "0" 
                type        = "RichHypoData&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                array       = "FALSE" 
                compression = "TRUE" 
                desc        = "The number of detectable emitted photons expected for each particle hypothesis" 
                name        = "nDetectablePhotons" 
                init        = "0" 
                type        = "RichHypoData&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                array       = "FALSE" 
                compression = "TRUE" 
                desc        = "The number of signal photons expected for each particle hypothesis" 
                name        = "nSignalPhotons" 
                init        = "0" 
                type        = "RichHypoData&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                array       = "FALSE" 
                compression = "TRUE" 
                desc        = "The number of scattered photons expected for each particle hypothesis"
                name        = "nScatteredPhotons" 
                init        = "0" 
                type        = "RichHypoData&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                desc        = "Photon energy spectra for emitted photons" 
                name        = "emittedPhotonSpectra" 
                type        = "RichPhotonSpectra&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                desc        = "Photon energy spectra for detectable photons" 
                name        = "detectablePhotonSpectra" 
                type        = "RichPhotonSpectra&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                desc        = "Photon energy spectra for signal photons" 
                name        = "signalPhotonSpectra" 
                type        = "RichPhotonSpectra&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                desc        = "The geometrical efficiency for a given hypothesis, binned per HPD" 
                init        = "Rich::NParticleTypes,PDGeomEffs() " 
                name        = "geomEfficiencyPerPD" 
                type        = "PDGeomEffsVector"
        />
            
        <attribute 
                desc        = "Geometrical efficiencies for the each particle hypothesis" 
                name        = "geomEfficiency" 
                init        = "0" 
                type        = "RichHypoData&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                desc        = "Geometrical efficiency for scattered component" 
                name        = "geomEfficiencyScat" 
                init        = "0" 
                type        = "RichHypoData&lt;RichRecSegment::FloatType&gt;"
        />
            
        <attribute 
                desc        = "The average Cherenkov theta angle for given particle ID type" 
                name        = "averageCKTheta" 
                init        = "0" 
                type        = "RichHypoData&lt;RichRecSegment::FloatType&gt;"
        />

        <attribute 
                desc        = "The average radius of the Cherenkov Ring on the HPD detector plane, in local coordinates, for given particle ID type" 
                name        = "averageCKRadiusLocal" 
                init        = "0" 
                type        = "RichHypoData&lt;RichRecSegment::FloatType&gt;"
        />

        <attribute 
                desc        = "Average radius in local coordinates of Saturated Cherenkov Cone for this segment" 
                name        = "avSaturatedRadiusLocal" 
                init        = "-999" 
                type        = "RichRecSegment::FloatType"
        />
            
        <attribute 
                desc        = "Track segment, the passage of a track through a Rich detector" 
                name        = "trackSegment" 
                type        = "RichTrackSegment"
        />
            
        <attribute
                desc        = "Ray traced PD panel impact point in global coordinates" 
                name        = "pdPanelHitPoint" 
                type        = "HepPoint3D"
        />
            
        <attribute 
                desc        = "Ray traced PD panel impact point in local coordinates" 
                name        = "pdPanelHitPointLocal" 
                type        = "HepPoint3D"
        />

        <relation 
                desc         = "Smart Reference to associated RichRecTrack" 
                name         = "richRecTrackSmartRef" 
                type         = "RichRecTrack"
                multiplicity = "1"
        />
            
        <attribute 
                desc        = "General information flags" 
                init        = "0" 
                name        = "trackInfo" 
                type        = "bitfield">
                <bitfield desc="Photons observable in x&gt;0 region of detector"    length="1" name="photonsInXPlus"  />
                <bitfield desc="Photons observable in x&lt;0 region of detector"    length="1" name="photonsInXMinus" />
                <bitfield desc="Photons observable in y&gt;0 region of detector"    length="1" name="photonsInYPlus"  />
                <bitfield desc="Photons observable in y&lt;0 region of detector"    length="1" name="photonsInYMinus" />
                <bitfield desc="Have all possible photon candidates have been made" length="1" name="allPhotonsDone"  />
        </attribute>

        <typedef 
                access       = "PUBLIC" 
                def          = "Pixels" 
                desc         = "Container type for RichRecPixels" 
                type         = "std::vector&lt;RichRecPixel*&gt;"
        />

        <typedef 
                access       = "PUBLIC" 
                def          = "Photons" 
                desc         = "Container type for RichRecPhotons" 
                type         = "std::vector&lt;RichRecPhoton*&gt;"
        />
            
        <attribute 
                compression  = "FALSE" 
                desc         = "Associated RichRecTrack" 
                init         = "0" 
                name         = "richRecTrack" 
                serialize    = "FALSE" 
                type         = "RichRecTrack*"
        />
            
        <attribute 
                access       = "PRIVATE" 
                desc         = "Associated RichRecPixels" 
                name         = "richRecPixels" 
                serialize    = "FALSE" 
                type         = "Pixels"
        />
           
        <method 
                desc         = "Add to associated RichRecPixels" 
                inline       = "TRUE" 
                name         = "addToRichRecPixels" >
                <arg const="FALSE" name="pixel" type="RichRecPixel*"/>
                <code>
                        m_richRecPixels.push_back(pixel);
                </code>
        </method>
            
        <attribute 
                access       = "PRIVATE" 
                desc         = "Associated RichRecPhotons" 
                name         = "richRecPhotons" 
                serialize    = "FALSE" 
                type         = "Photons"
        />
        
        <method 
                desc         = "Add to associated RichRecPhotons" 
                inline       = "TRUE" 
                name         = "addToRichRecPhotons" >
                <arg const="FALSE" name="photon" type="RichRecPhoton*"/>
                <code>
                        m_richRecPhotons.push_back(photon);
                </code>
        </method>

        <attribute 
                array       = "FALSE" 
                compression = "TRUE" 
                desc        = "Expected Rings for each mass hypothesis" 
                init        = "NULL" 
                name        = "hypothesisRings" 
                type        = "RichHypoData&lt;RichRecRing*&gt;"
        />

<!--
        <relation 
                desc         = "SmartRefVector of RichRecPixels for which this track has valid photon associations"
                multiplicity = "N" 
                name         = "richRecPixelsSmartRefs" 
                type         = "RichRecPixel"
        />
            
        <relation 
                desc         = "SmartRef to associated RichRecPhotons" 
                multiplicity = "N" 
                name         = "richRecPhotonsSmartRefs" 
                type         = "RichRecPhoton"
        />
-->

</class>

</package>
</gdd>
