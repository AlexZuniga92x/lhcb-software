// $Id: HltTFilter.h,v 1.5 2008-07-04 08:07:41 graven Exp $
#ifndef HLTCOMMON_HLTTFILTER_H 
#define HLTCOMMON_HLTTFILTER_H 1

// Include files
// from Gaudi
#include "HltBase/HltAlgorithm.h"
#include "HltBase/IFunctionFactory.h"

/** @class HltTrackFilter HltTrackFilter.h
 *  
 *
 *  @author Jose Angel Hernando Morata
 *  @date   2007-03-22
 */

namespace Hlt {
  template <class T>
  class TFilterData {
  public:
    TFilterData(const std::string& name) 
        : filtername(name)
        , minvalue(-1e6)
        , maxvalue(1e6)
    {}
    virtual ~TFilterData()  {}
  private:
    // make sure the copy c'tor is not autogenerated
    TFilterData(const TFilterData<T>&);
  public:    
    std::string filtername;
    std::string functionname;
    std::string input2;
    int infoID;
    std::auto_ptr<zen::function<T> > function;
    std::auto_ptr<zen::filter<T> > filter;
    Hlt::Counter counter;
    Hlt::Counter counterCandidates;
    std::string operation;
    double minvalue;
    double maxvalue;
    bool isMin() const { return operation!=">"; }
    Hlt::Histo* histovalues;
    Hlt::Histo* histobest;
  };  
}

template <class T>
class HltTFilter : public HltAlgorithm {
public: 
  /// Standard constructor
  HltTFilter( const std::string& algoname, ISvcLocator* pSvcLocator, const std::string& factoryName, bool tesInput=false );

  virtual ~HltTFilter( );

  virtual StatusCode initialize();
  virtual StatusCode execute   ();
  virtual StatusCode finalize  ();

private:
  typedef typename Hlt::TSelection<T> TSelection;
  typedef typename Hlt::TFilterData<T> TFilterData;
  typedef typename std::vector<TFilterData*>::iterator TFilterDataIterator;
  typedef typename zen::function<T> TFunction;
  typedef typename zen::filter<T> TFilter;
  //typedef typename std::vector<T*> TContainer;
  //typedef typename std::vector<T*>::iterator TContainerIterator;

  virtual void saveConfiguration();  
  bool addTFilterData(const std::string& filtername);


  bool m_tesInput;
  bool m_addInfo;

  TSelection* m_tselinput;
  TSelection* m_tseloutput;

  StringArrayProperty m_filterDescriptor;
  std::vector< TFilterData* > m_tfilters;

  std::string m_functionFactoryName;
  IFunctionFactory<T>* m_factory;
};
#endif // HLTTRACKFILTER_H
