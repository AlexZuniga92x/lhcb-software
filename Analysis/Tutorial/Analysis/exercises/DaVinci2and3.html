<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><title>LHCb-Bologna Software Training</title>
    
    
    <link rel="stylesheet" media="screen" type="text/css" 
      href="http://www.hep.phy.cam.ac.uk/lhcb/LHCbSoftTraining/documents/lhcb-cambridge-blue.css">

      <link rel="stylesheet" media="print" type="text/css" 
	href="http://www.hep.phy.cam.ac.uk/lhcb/LHCbSoftTraining/documents/lhcb-cambridge-print.css"></head><body>

  <body>

    <table id="titlebar">
      <tbody>
	<tr style="vertical-align: bottom;">
	  <td style="padding-bottom: 15px;">
	    <h1>LHCb Software Training: DaVinci</h1></td>
	  <td id="lhcblogo" style="text-align: right;">
	    <a href="http://cern.ch/lhcb">
	      <img src="http://lhcb.web.cern.ch/lhcb/lhcblogo.gif"></a></td>
	</tr>
      </tbody>
    </table>
    
    <div id="content">
      
      <h1><span lang="en-gb">Exercises linked to DaVinci session 2</span></h1>
      
      <p>
	The purpose of these exercises is to allow you to write a complete
	though simple selection algorithms for a typical decay: Bs->J/psiPhi.
	Let's do the J/psi first

		<h2>1. Add some global variables</h2>
		<ul>
			<li>We want to be able to cut on the J/psi mass
			and the vertex chi<sup>2</sup> at least. And change 
			the cut values by options.</li>
<code class="display">private:
  double m_jPsiMassWin ; ///< Mass window
  double m_jPsiChi2 ;    ///< Max J/psi chi^2
</code>
			<li>Let's also add some statistics,
			and store a few things we will need in the 
			execute()</li>
<code class="display">  int m_jPsiID ;      ///< J/psi ID
  double m_jPsiMass ; ///< J/psi mass
  int m_nJPsis ;      ///< number of J/psis
  int m_nEvents ;     ///< number of Events</code>
			<li>It is mandatory to initialise everything
			in the constructor</li>
<code class="display">TutorialAlgorithm::TutorialAlgorithm( 
   const std::string& name, ISvcLocator* pSvcLocator)
  : DVAlgorithm ( name , pSvcLocator )
    , m_jPsiID(0)
    , m_jPsiMass(0.)
    , m_nJPsis(0)
    , m_nEvents(0)
{
  declareProperty("MassWindow", m_jPsiMassWin = 10.*GeV); 
  declareProperty("MaxChi2", m_jPsiChi2 = 1000.);
}
</code>
			<li>Of course, we want to
			get some real numbers in there.
			This happens in initialize()</li>
<code class="display">  debug() << "==> Initialize" << endmsg;
  ParticleProperty* psi = ppSvc()->find( "J/psi(1S)" );
</code>
                        <p>Now get the mass and the PID of the J/psi
			from the ParticleProperty.</p>

		</ul>

		<h2>2. Make the J/psi</h2>
		<ul>
		  <li>First separate positive and negative muons. This
		  is best done using the ParticleFilter tool.</li>
		  
<code class="display">  LHCb::Particle::ConstVector MuPlus, MuMinus;
  sc = particleFilter()->filterNegative(muons,MuMinus);
  if (sc) sc = particleFilter()->filterPositive(muons,MuPlus);</code>
  		  <p>Assuming that the muons you got from the desktop are
		  in a vector called <code>muons</code>.</p>

		<li>Loop over the muons, you already know how.</li>

		<li>Cut on the dimuon mass <b>before</b> you make the
		    vertex, as the latter takes much more CPU. 
		     
<code class="display">  Gaudi::LorentzVector twoMu = (*imp)->momentum() + (*imm)->momentum() ;
  if ( fabs ( twoMu.M() - m_jPsiMass ) > m_jPsiMassWin ) continue ; // mass cuts
</code>
                <p>You probably also want to plot the mass before the cut, and maybe to
                 print it out in debug() or verbose() level.</p>

		<li>Now call the vertex fitter. It will return you a
		 vertex <b>and the J/psi Particle</b>.
		     
<code class="display">  LHCb::Vertex MuMuVertex;
  LHCb::Particle Jpsi(m_jPsiID);
  StatusCode scFit = vertexFitter()->fit(*(*imp),*(*imm),Jpsi,MuMuVertex);
  if (!scFit) {
    Warning("Fit error");
    continue;
  }</code>
                <p>Presently the fitter returns a failure 
		if the fit failed. This is not a good reason to stop
		the execution. So catch this error and handle it
		properly.</p>


		<li>Now cut on the chi<sup>2</sup>.
		     
<code class="display">  if ( MuMuVertex.chi2() > m_jPsiChi2 ) continue ; // chi2 cut
</code>
                <p>But maybe you should fill a histogram with the chi2 first.</p>

		<li>Save the J/psi</sup>.
		     
<code class="display">  desktop()->save(&Jpsi);
  setFilterPassed(true);   // Mandatory. Set to true if event is accepted.
</code>
                <p>This declares the J/psi to the PhysDesktop. It
		   does not save it yet.</p>
                <p>Since you have a J/psi you can set FilterPassed
		to true, which tells the sequencer the algorithm 
		found what it was looking for.</p>

		<li>Save all J/psis</sup>.
                <p>At the end of the method you should ask the
		   desktop to save it all.</p>
		     
<code class="display">  return desktop()->saveDesktop() ;      
</code>

 		</ul>
		<h2>3. Don't forget the counters</h2>
		<ul>
		<li>Increment the counters where suitable.</li>
		<li>Print out their value in the finalisation.</li>
 		</ul>

		<h2>4. Run it</h2>
		<ul>
		<li>Set the appropriate options.</li>
<code class="display">TutorialSeq.Members += { "TutorialAlgorithm/Jpsi2MuMu" };
Jpsi2MuMu.PhysDesktop.InputLocations = { "Phys/StdLooseMuons" } ;
Jpsi2MuMu.MassWindow = 50*MeV ;
Jpsi2MuMu.MaxChi2 = 100 ;
Jpsi2MuMu.OutputLevel = 3 ;
</code>

		<li>Get data from the bookkeeping</li>
		<p>There is J/psi Ks data available in the bookkeeping.
		You'll get more J/psi's from this data than from the BB 
		inclusive!</p>
		<p>Pay attention to restrict yourself to the latest Gauss
		   version available.</p>
 		</ul>

		<h2>5. Help!</h2>
 		<ul>
                 The solution is given in <code>solutions/DaVinci2</code>

 		</ul>
      
      <h1><span lang="en-gb">More exercises linked to DaVinci session 2</span></h1>
      
      <p>
	You could actually use this algorithm to make the Phi too. 
	The procedure for selecting the Phi is the same, it's just
	the properties of the mother and the type of the daughters
	that change.
	
	<ul>
	  <li>Adapt <code>TutorialAlgorithm</code> in order to be able to select
	  J/psi and Phi depending on the configuration. The options should look like:</li>
	  
<code class="display">//
// J/psi->mumu selection
//
TutorialSeq.Members += { "TutorialAlgorithm/Jpsi2MuMu" };
Jpsi2MuMu.PhysDesktop.InputLocations = { "Phys/StdLooseMuons" } ;
Jpsi2MuMu.Particle = "J/psi(1S)" ;
Jpsi2MuMu.MassWindow = 50*MeV ;
Jpsi2MuMu.MaxChi2 = 100 ;
Jpsi2MuMu.OutputLevel = 3 ;
//
// Phi->KK selection
//
TutorialSeq.Members += { "TutorialAlgorithm/Phi2KK" };
Phi2KK.PhysDesktop.InputLocations = { "Phys/StdLooseKaons" } ;
Phi2KK.Particle =  "phi(1020)" ;
Phi2KK.MassWindow = 50*MeV ;
Phi2KK.MaxChi2 = 100 ;
Phi2KK.OutputLevel = 3 ;
</code>

The solution is given in <code>solutions/DaVinci3</code>
	  
	</ul>
	

</p>
<hr>
<p><span lang="en-gb">Last modified by P. Koppenburg, June 1 2006
</div>
</body></html>
